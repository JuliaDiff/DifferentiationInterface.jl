<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Dev guide · DifferentiationInterface.jl</title><meta name="title" content="Dev guide · DifferentiationInterface.jl"/><meta property="og:title" content="Dev guide · DifferentiationInterface.jl"/><meta property="twitter:title" content="Dev guide · DifferentiationInterface.jl"/><meta name="description" content="Documentation for DifferentiationInterface.jl."/><meta property="og:description" content="Documentation for DifferentiationInterface.jl."/><meta property="twitter:description" content="Documentation for DifferentiationInterface.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="DifferentiationInterface.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">DifferentiationInterface.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../tutorials/basic/">Basic tutorial</a></li><li><a class="tocitem" href="../tutorials/advanced/">Advanced tutorial</a></li></ul></li><li><span class="tocitem">Explanation</span><ul><li><a class="tocitem" href="../explanation/operators/">Operators</a></li><li><a class="tocitem" href="../explanation/backends/">Backends</a></li><li><a class="tocitem" href="../explanation/advanced/">Advanced features</a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li><li class="is-active"><a class="tocitem" href>Dev guide</a><ul class="internal"><li><a class="tocitem" href="#General-principles"><span>General principles</span></a></li><li><a class="tocitem" href="#New-operator"><span>New operator</span></a></li><li><a class="tocitem" href="#New-backend"><span>New backend</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Dev guide</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Dev guide</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaDiff/DifferentiationInterface.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaDiff/DifferentiationInterface.jl/blob/main/DifferentiationInterface/docs/src/dev_guide.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Dev-guide"><a class="docs-heading-anchor" href="#Dev-guide">Dev guide</a><a id="Dev-guide-1"></a><a class="docs-heading-anchor-permalink" href="#Dev-guide" title="Permalink"></a></h1><p>This page is important reading if you want to contribute to DifferentiationInterface.jl. It is not part of the public API and the content below may become outdated, in which case you should refer to the source code as the ground truth.</p><h2 id="General-principles"><a class="docs-heading-anchor" href="#General-principles">General principles</a><a id="General-principles-1"></a><a class="docs-heading-anchor-permalink" href="#General-principles" title="Permalink"></a></h2><p>The package is structured around 8 <a href="../explanation/operators/#Operators">operators</a>:</p><ul><li><a href="../api/#DifferentiationInterface.derivative"><code>derivative</code></a></li><li><a href="../api/#DifferentiationInterface.second_derivative"><code>second_derivative</code></a></li><li><a href="../api/#DifferentiationInterface.gradient"><code>gradient</code></a></li><li><a href="../api/#DifferentiationInterface.jacobian"><code>jacobian</code></a></li><li><a href="../api/#DifferentiationInterface.hessian"><code>hessian</code></a></li><li><a href="../api/#DifferentiationInterface.pushforward"><code>pushforward</code></a></li><li><a href="../api/#DifferentiationInterface.pullback"><code>pullback</code></a></li><li><a href="../api/#DifferentiationInterface.hvp"><code>hvp</code></a></li></ul><p>Most operators have 4 variants, which look like this in the first order: <code>operator</code>, <code>operator!</code>, <code>value_and_operator</code>, <code>value_and_operator!</code>.</p><h2 id="New-operator"><a class="docs-heading-anchor" href="#New-operator">New operator</a><a id="New-operator-1"></a><a class="docs-heading-anchor-permalink" href="#New-operator" title="Permalink"></a></h2><p>To implement a new operator for an existing backend, you need to write 5 methods: 1 for <a href="../explanation/operators/#Preparation">preparation</a> and 4 corresponding to the variants of the operator (see above). For first-order operators, you may also want to support <a href="../explanation/operators/#Mutation-and-signatures">in-place functions</a>, which requires another 5 methods (defined on <code>f!</code> instead of <code>f</code>).</p><p>The method <code>prepare_operator</code> must output a <code>prep</code> object of the correct type. For instance, <code>prepare_gradient(f, backend, x)</code> must return a <a href="../api/#DifferentiationInterface.GradientPrep"><code>DifferentiationInterface.GradientPrep</code></a>. Assuming you don&#39;t need any preparation for said operator, you can use the trivial prep that are already defined, like <code>DifferentiationInterface.NoGradientPrep</code>. Otherwise, define a custom struct like <code>MyGradientPrep &lt;: DifferentiationInterface.GradientPrep</code> and put the necessary storage in there.</p><h2 id="New-backend"><a class="docs-heading-anchor" href="#New-backend">New backend</a><a id="New-backend-1"></a><a class="docs-heading-anchor-permalink" href="#New-backend" title="Permalink"></a></h2><p>If you want to implement a new backend, for instance because you developed a new AD package called <code>SuperDiff</code>, please open a pull request to DifferentiationInterface.jl. Your AD package needs to be registered first.</p><h3 id="Core-code"><a class="docs-heading-anchor" href="#Core-code">Core code</a><a id="Core-code-1"></a><a class="docs-heading-anchor-permalink" href="#Core-code" title="Permalink"></a></h3><p>In the main package, you should define a new struct <code>SuperDiffBackend</code> which subtypes <a href="https://sciml.github.io/ADTypes.jl/stable/#ADTypes.AbstractADType"><code>ADTypes.AbstractADType</code></a>, and endow it with the fields you need to parametrize your differentiation routines. You also have to define <a href="https://sciml.github.io/ADTypes.jl/stable/#ADTypes.mode"><code>ADTypes.mode</code></a> and <a href="../api/#DifferentiationInterface.inplace_support-Tuple{ADTypes.AbstractADType}"><code>DifferentiationInterface.inplace_support</code></a> on <code>SuperDiffBackend</code>.</p><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p>In the end, this backend struct will need to be contributed to <a href="https://github.com/SciML/ADTypes.jl">ADTypes.jl</a>. However, putting it in the DifferentiationInterface.jl PR is a good first step for debugging.</p></div></div><p>In a <a href="https://pkgdocs.julialang.org/v1/creating-packages/#Conditional-loading-of-code-in-packages-(Extensions)">package extension</a> named <code>DifferentiationInterfaceSuperDiffExt</code>, you need to implement at least <a href="../api/#DifferentiationInterface.pushforward"><code>pushforward</code></a> or <a href="../api/#DifferentiationInterface.pullback"><code>pullback</code></a> (and their variants). The exact requirements depend on the differentiation mode you chose:</p><table><tr><th style="text-align: left">backend mode</th><th style="text-align: left">pushforward necessary</th><th style="text-align: left">pullback necessary</th></tr><tr><td style="text-align: left"><a href="https://sciml.github.io/ADTypes.jl/stable/#ADTypes.ForwardMode"><code>ADTypes.ForwardMode</code></a></td><td style="text-align: left">yes</td><td style="text-align: left">no</td></tr><tr><td style="text-align: left"><a href="https://sciml.github.io/ADTypes.jl/stable/#ADTypes.ReverseMode"><code>ADTypes.ReverseMode</code></a></td><td style="text-align: left">no</td><td style="text-align: left">yes</td></tr><tr><td style="text-align: left"><a href="https://sciml.github.io/ADTypes.jl/stable/#ADTypes.ForwardOrReverseMode"><code>ADTypes.ForwardOrReverseMode</code></a></td><td style="text-align: left">yes</td><td style="text-align: left">yes</td></tr><tr><td style="text-align: left"><a href="https://sciml.github.io/ADTypes.jl/stable/#ADTypes.SymbolicMode"><code>ADTypes.SymbolicMode</code></a></td><td style="text-align: left">yes</td><td style="text-align: left">yes</td></tr></table><p>Every other operator can be deduced from these two, but you can gain efficiency by implementing additional operators.</p><h3 id="Tests-and-docs"><a class="docs-heading-anchor" href="#Tests-and-docs">Tests and docs</a><a id="Tests-and-docs-1"></a><a class="docs-heading-anchor-permalink" href="#Tests-and-docs" title="Permalink"></a></h3><p>Once that is done, you need to add your new backend to the test suite. Test files should be gathered in a folder named <code>SuperDiff</code> inside <a href="https://github.com/JuliaDiff/DifferentiationInterface.jl/tree/main/DifferentiationInterface/test/Back"><code>DifferentiationInterface/test/Back</code></a>. They should use <a href="https://github.com/JuliaDiff/DifferentiationInterface.jl/tree/main/DifferentiationInterfaceTest">DifferentiationInterfaceTest.jl</a> to check correctness against the default scenarios. Take inspiration from the tests of other backends to write your own. To activate tests in CI, modify the <a href="https://github.com/JuliaDiff/DifferentiationInterface.jl/blob/main/.github/workflows/Test.yml">test workflow</a> and add your package to the list. To run the tests locally, replace the following line in <a href="https://github.com/JuliaDiff/DifferentiationInterface.jl/blob/main/DifferentiationInterface/test/runtests.jl"><code>DifferentiationInterface/test/runtests.jl</code></a></p><pre><code class="language-julia hljs">GROUP = get(ENV, &quot;JULIA_DI_TEST_GROUP&quot;, &quot;All&quot;)</code></pre><p>with the much cheaper version</p><pre><code class="language-julia hljs">GROUP = get(ENV, &quot;JULIA_DI_TEST_GROUP&quot;, &quot;Back/SuperDiff&quot;)</code></pre><p>but don&#39;t forget to switch it back before pushing.</p><p>Finally, you need to add your backend to the documentation, modifying every page that involves a list of backends (including the <code>README.md</code>).</p><script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
mermaid.initialize({
    startOnLoad: true,
    theme: "neutral"
});
</script></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../api/">« API</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Wednesday 6 November 2024 18:41">Wednesday 6 November 2024</span>. Using Julia version 1.11.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
