<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Backends ¬∑ DifferentiationInterface.jl</title><meta name="title" content="Backends ¬∑ DifferentiationInterface.jl"/><meta property="og:title" content="Backends ¬∑ DifferentiationInterface.jl"/><meta property="twitter:title" content="Backends ¬∑ DifferentiationInterface.jl"/><meta name="description" content="Documentation for DifferentiationInterface.jl."/><meta property="og:description" content="Documentation for DifferentiationInterface.jl."/><meta property="twitter:description" content="Documentation for DifferentiationInterface.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="DifferentiationInterface.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DifferentiationInterface.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/basic/">Basic tutorial</a></li><li><a class="tocitem" href="../../tutorials/advanced/">Advanced tutorial</a></li></ul></li><li><span class="tocitem">Explanation</span><ul><li><a class="tocitem" href="../operators/">Operators</a></li><li class="is-active"><a class="tocitem" href>Backends</a><ul class="internal"><li><a class="tocitem" href="#List"><span>List</span></a></li><li><a class="tocitem" href="#Features"><span>Features</span></a></li><li><a class="tocitem" href="#Second-order"><span>Second order</span></a></li><li><a class="tocitem" href="#Backend-switch"><span>Backend switch</span></a></li><li><a class="tocitem" href="#Implementations"><span>Implementations</span></a></li></ul></li><li><a class="tocitem" href="../advanced/">Advanced features</a></li></ul></li><li><span class="tocitem">FAQ</span><ul><li><a class="tocitem" href="../../faq/limitations/">Limitations</a></li><li><a class="tocitem" href="../../faq/differentiability/">Differentiability</a></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li><li><a class="tocitem" href="../../dev_guide/">Dev guide</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Explanation</a></li><li class="is-active"><a href>Backends</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Backends</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaDiff/DifferentiationInterface.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ÔÇõ</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaDiff/DifferentiationInterface.jl/blob/main/DifferentiationInterface/docs/src/explanation/backends.md" title="Edit source on GitHub"><span class="docs-icon fa-solid">ÔÅÑ</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Backends"><a class="docs-heading-anchor" href="#Backends">Backends</a><a id="Backends-1"></a><a class="docs-heading-anchor-permalink" href="#Backends" title="Permalink"></a></h1><h2 id="List"><a class="docs-heading-anchor" href="#List">List</a><a id="List-1"></a><a class="docs-heading-anchor-permalink" href="#List" title="Permalink"></a></h2><p>We support the following dense backend choices from <a href="https://github.com/SciML/ADTypes.jl">ADTypes.jl</a>:</p><ul><li><a href="https://sciml.github.io/ADTypes.jl/stable/#ADTypes.AutoChainRules"><code>AutoChainRules</code></a></li><li><a href="https://sciml.github.io/ADTypes.jl/stable/#ADTypes.AutoDiffractor"><code>AutoDiffractor</code></a></li><li><a href="https://sciml.github.io/ADTypes.jl/stable/#ADTypes.AutoEnzyme"><code>AutoEnzyme</code></a></li><li><a href="https://sciml.github.io/ADTypes.jl/stable/#ADTypes.AutoFastDifferentiation"><code>AutoFastDifferentiation</code></a></li><li><a href="https://sciml.github.io/ADTypes.jl/stable/#ADTypes.AutoFiniteDiff"><code>AutoFiniteDiff</code></a></li><li><a href="https://sciml.github.io/ADTypes.jl/stable/#ADTypes.AutoFiniteDifferences"><code>AutoFiniteDifferences</code></a></li><li><a href="https://sciml.github.io/ADTypes.jl/stable/#ADTypes.AutoForwardDiff"><code>AutoForwardDiff</code></a></li><li><a href="https://sciml.github.io/ADTypes.jl/stable/#ADTypes.AutoGTPSA"><code>AutoGTPSA</code></a></li><li><a href="https://sciml.github.io/ADTypes.jl/stable/#ADTypes.AutoMooncake"><code>AutoMooncake</code></a></li><li><a href="https://sciml.github.io/ADTypes.jl/stable/#ADTypes.AutoPolyesterForwardDiff"><code>AutoPolyesterForwardDiff</code></a></li><li><a href="https://sciml.github.io/ADTypes.jl/stable/#ADTypes.AutoReverseDiff"><code>AutoReverseDiff</code></a></li><li><a href="https://sciml.github.io/ADTypes.jl/stable/#ADTypes.AutoSymbolics"><code>AutoSymbolics</code></a></li><li><a href="https://sciml.github.io/ADTypes.jl/stable/#ADTypes.AutoTracker"><code>AutoTracker</code></a></li><li><a href="https://sciml.github.io/ADTypes.jl/stable/#ADTypes.AutoZygote"><code>AutoZygote</code></a></li></ul><h2 id="Features"><a class="docs-heading-anchor" href="#Features">Features</a><a id="Features-1"></a><a class="docs-heading-anchor-permalink" href="#Features" title="Permalink"></a></h2><p>Given a backend object, you can use:</p><ul><li><a href="../../api/#DifferentiationInterface.check_available"><code>check_available</code></a> to know whether the required AD package is loaded</li><li><a href="../../api/#DifferentiationInterface.check_inplace"><code>check_inplace</code></a> to know whether the backend supports in-place functions (all backends support out-of-place functions)</li></ul><p>In theory, all we need from each backend is either a <code>pushforward</code> or a <code>pullback</code>: we can deduce every other operator from these two. In practice, many AD backends have custom implementations for high-level operators like <code>gradient</code> or <code>jacobian</code>, which we reuse whenever possible.</p><details class="admonition is-details"><summary class="admonition-header">Details</summary><div class="admonition-body"><p>In the rough summary table below,</p><ul><li>‚úÖ means that we reuse the custom implementation from the backend;</li><li>‚ùå means that a custom implementation doesn&#39;t exist, so we use our default fallbacks;</li><li>üîÄ means it&#39;s complicated or not done yet.</li></ul><table><tr><th style="text-align: right"></th><th style="text-align: right"><code>pf</code></th><th style="text-align: right"><code>pb</code></th><th style="text-align: right"><code>der</code></th><th style="text-align: right"><code>grad</code></th><th style="text-align: right"><code>jac</code></th><th style="text-align: right"><code>hess</code></th><th style="text-align: right"><code>hvp</code></th><th style="text-align: right"><code>der2</code></th></tr><tr><td style="text-align: right"><code>AutoChainRules</code></td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td></tr><tr><td style="text-align: right"><code>AutoDiffractor</code></td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td></tr><tr><td style="text-align: right"><code>AutoEnzyme</code> (forward)</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td></tr><tr><td style="text-align: right"><code>AutoEnzyme</code> (reverse)</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚ùå</td><td style="text-align: right">üîÄ</td><td style="text-align: right">‚ùå</td></tr><tr><td style="text-align: right"><code>AutoFastDifferentiation</code></td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td></tr><tr><td style="text-align: right"><code>AutoFiniteDiff</code></td><td style="text-align: right">üîÄ</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td></tr><tr><td style="text-align: right"><code>AutoFiniteDifferences</code></td><td style="text-align: right">üîÄ</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td></tr><tr><td style="text-align: right"><code>AutoForwardDiff</code></td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td></tr><tr><td style="text-align: right"><code>AutoGTPSA</code></td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td></tr><tr><td style="text-align: right"><code>AutoMooncake</code></td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td></tr><tr><td style="text-align: right"><code>AutoPolyesterForwardDiff</code></td><td style="text-align: right">üîÄ</td><td style="text-align: right">‚ùå</td><td style="text-align: right">üîÄ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">üîÄ</td><td style="text-align: right">üîÄ</td><td style="text-align: right">üîÄ</td></tr><tr><td style="text-align: right"><code>AutoReverseDiff</code></td><td style="text-align: right">‚ùå</td><td style="text-align: right">üîÄ</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td></tr><tr><td style="text-align: right"><code>AutoSymbolics</code></td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td></tr><tr><td style="text-align: right"><code>AutoTracker</code></td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td></tr><tr><td style="text-align: right"><code>AutoZygote</code></td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">üîÄ</td><td style="text-align: right">‚ùå</td></tr></table></div></details><p>Moreover, each context type is supported by a specific subset of backends:</p><table><tr><th style="text-align: right"></th><th style="text-align: right"><a href="../../api/#DifferentiationInterface.Constant"><code>Constant</code></a></th><th style="text-align: right"><a href="../../api/#DifferentiationInterface.Cache"><code>Cache</code></a></th></tr><tr><td style="text-align: right"><code>AutoChainRules</code></td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚ùå</td></tr><tr><td style="text-align: right"><code>AutoDiffractor</code></td><td style="text-align: right">‚ùå</td><td style="text-align: right">‚ùå</td></tr><tr><td style="text-align: right"><code>AutoEnzyme</code> (forward)</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td></tr><tr><td style="text-align: right"><code>AutoEnzyme</code> (reverse)</td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚ùå (soon)</td></tr><tr><td style="text-align: right"><code>AutoFastDifferentiation</code></td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td></tr><tr><td style="text-align: right"><code>AutoFiniteDiff</code></td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td></tr><tr><td style="text-align: right"><code>AutoFiniteDifferences</code></td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td></tr><tr><td style="text-align: right"><code>AutoForwardDiff</code></td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td></tr><tr><td style="text-align: right"><code>AutoGTPSA</code></td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚ùå</td></tr><tr><td style="text-align: right"><code>AutoMooncake</code></td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td></tr><tr><td style="text-align: right"><code>AutoPolyesterForwardDiff</code></td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚úÖ</td></tr><tr><td style="text-align: right"><code>AutoReverseDiff</code></td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚ùå</td></tr><tr><td style="text-align: right"><code>AutoSymbolics</code></td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚ùå</td></tr><tr><td style="text-align: right"><code>AutoTracker</code></td><td style="text-align: right">‚úÖ</td><td style="text-align: right">‚ùå</td></tr><tr><td style="text-align: right"><code>AutoZygote</code></td><td style="text-align: right">‚úÖ</td><td style="text-align: right">üîÄ</td></tr></table><h2 id="Second-order"><a class="docs-heading-anchor" href="#Second-order">Second order</a><a id="Second-order-1"></a><a class="docs-heading-anchor-permalink" href="#Second-order" title="Permalink"></a></h2><p>For second-order operators like <a href="../../api/#DifferentiationInterface.second_derivative"><code>second_derivative</code></a>, <a href="../../api/#DifferentiationInterface.hessian"><code>hessian</code></a> and <a href="../../api/#DifferentiationInterface.hvp"><code>hvp</code></a>, there are two main options. You can either use a single backend, or combine two of them within the <a href="../../api/#DifferentiationInterface.SecondOrder"><code>SecondOrder</code></a> struct:</p><pre><code class="language-julia hljs">backend = SecondOrder(outer_backend, inner_backend)</code></pre><p>The inner backend will be called first, and the outer backend will differentiate the generated code. In general, using a forward outer backend over a reverse inner backend will yield the best performance.</p><div class="admonition is-danger"><header class="admonition-header">Danger</header><div class="admonition-body"><p>Second-order AD is tricky, and many backend combinations will fail (even if you combine a backend with itself). Be ready to experiment and open issues if necessary.</p></div></div><h2 id="Backend-switch"><a class="docs-heading-anchor" href="#Backend-switch">Backend switch</a><a id="Backend-switch-1"></a><a class="docs-heading-anchor-permalink" href="#Backend-switch" title="Permalink"></a></h2><p>The wrapper <a href="../../api/#DifferentiationInterface.DifferentiateWith"><code>DifferentiateWith</code></a> allows you to switch between backends. It takes a function <code>f</code> and specifies that <code>f</code> should be differentiated with the substitute backend of your choice, instead of whatever true backend the surrounding code is trying to use. In other words, when someone tries to differentiate <code>dw = DifferentiateWith(f, substitute_backend)</code> with <code>true_backend</code>, then <code>substitute_backend</code> steps in and <code>true_backend</code> does not dive into the function <code>f</code> itself. At the moment, <code>DifferentiateWith</code> only works when <code>true_backend</code> is either <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a> or a <a href="https://github.com/JuliaDiff/ChainRules.jl">ChainRules.jl</a>-compatible backend.</p><h2 id="Implementations"><a class="docs-heading-anchor" href="#Implementations">Implementations</a><a id="Implementations-1"></a><a class="docs-heading-anchor-permalink" href="#Implementations" title="Permalink"></a></h2><p>What follows is a list of implementation details from the package extensions of DifferentiationInterface.jl It is not part of the public API or protected by semantic versioning, and it may become outdated. When in doubt, refer to the code itself.</p><h3 id="ChainRulesCore"><a class="docs-heading-anchor" href="#ChainRulesCore">ChainRulesCore</a><a id="ChainRulesCore-1"></a><a class="docs-heading-anchor-permalink" href="#ChainRulesCore" title="Permalink"></a></h3><p>We only implement <code>pullback</code>, using the <a href="https://juliadiff.org/ChainRulesCore.jl/stable/rule_author/superpowers/ruleconfig.html#config"><code>RuleConfig</code> mechanism</a> to call back into AD. Same-point preparation runs the forward sweep and returns the pullback closure.</p><h3 id="Diffractor"><a class="docs-heading-anchor" href="#Diffractor">Diffractor</a><a id="Diffractor-1"></a><a class="docs-heading-anchor-permalink" href="#Diffractor" title="Permalink"></a></h3><p>We only implement <code>pushforward</code>.</p><div class="admonition is-danger"><header class="admonition-header">Danger</header><div class="admonition-body"><p>The latest releases of Diffractor <a href="https://github.com/JuliaDiff/Diffractor.jl/issues/290">broke DifferentiationInterface</a>.</p></div></div><h3 id="Enzyme"><a class="docs-heading-anchor" href="#Enzyme">Enzyme</a><a id="Enzyme-1"></a><a class="docs-heading-anchor-permalink" href="#Enzyme" title="Permalink"></a></h3><p>Depending on the <code>mode</code> attribute inside <a href="https://sciml.github.io/ADTypes.jl/stable/#ADTypes.AutoEnzyme"><code>AutoEnzyme</code></a>, we implement either <code>pushforward</code> or <code>pullback</code> based on <code>Enzyme.autodiff</code>. When necessary, preparation chooses a number of chunks (for <code>gradient</code> and <code>jacobian</code> in forward mode, for <code>jacobian</code> only in reverse mode).</p><h3 id="FastDifferentiation"><a class="docs-heading-anchor" href="#FastDifferentiation">FastDifferentiation</a><a id="FastDifferentiation-1"></a><a class="docs-heading-anchor-permalink" href="#FastDifferentiation" title="Permalink"></a></h3><p>For every operator, preparation generates an <a href="https://brianguenter.github.io/FastDifferentiation.jl/stable/makefunction/">executable function</a> from the symbolic expression of the differentiated function.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Preparation can be very slow for symbolic AD.</p></div></div><h3 id="FiniteDiff"><a class="docs-heading-anchor" href="#FiniteDiff">FiniteDiff</a><a id="FiniteDiff-1"></a><a class="docs-heading-anchor-permalink" href="#FiniteDiff" title="Permalink"></a></h3><p>Whenever possible, preparation creates a cache object. Pushforward is implemented rather slowly using a closure.</p><h3 id="FiniteDifferences"><a class="docs-heading-anchor" href="#FiniteDifferences">FiniteDifferences</a><a id="FiniteDifferences-1"></a><a class="docs-heading-anchor-permalink" href="#FiniteDifferences" title="Permalink"></a></h3><p>Nothing specific to mention.</p><h3 id="ForwardDiff"><a class="docs-heading-anchor" href="#ForwardDiff">ForwardDiff</a><a id="ForwardDiff-1"></a><a class="docs-heading-anchor-permalink" href="#ForwardDiff" title="Permalink"></a></h3><p>We implement <a href="../../api/#DifferentiationInterface.pushforward"><code>pushforward</code></a> directly using <a href="https://juliadiff.org/ForwardDiff.jl/stable/dev/how_it_works/"><code>Dual</code> numbers</a>, and preparation allocates the necessary space. For higher level operators, preparation creates a <a href="https://juliadiff.org/ForwardDiff.jl/stable/user/api/#Preallocating/Configuring-Work-Buffers">config object</a>, which can be type-unstable.</p><h3 id="GTPSA"><a class="docs-heading-anchor" href="#GTPSA">GTPSA</a><a id="GTPSA-1"></a><a class="docs-heading-anchor-permalink" href="#GTPSA" title="Permalink"></a></h3><p>For all operators, preparation preallocates the input <a href="https://bmad-sim.github.io/GTPSA.jl/stable/man/c_tps/"><code>TPS</code>s</a>, and for in-place functions the output <code>TPS</code>s as well. For minimal allocations of <code>TPS</code> temporaries inside of a function, the <a href="https://bmad-sim.github.io/GTPSA.jl/stable/man/j_fastgtpsa/"><code>@FastGTPSA</code>/<code>@FastGTPSA!</code></a> macros are recommended.</p><p>If a GTPSA <a href="https://bmad-sim.github.io/GTPSA.jl/stable/man/b_descriptor/"><code>Descriptor</code></a> is not provided to <code>AutoGTPSA</code>, then a <code>Descriptor</code> will be generated in preparation based on the context.</p><div class="admonition is-danger"><header class="admonition-header">Danger</header><div class="admonition-body"><p>When providing a custom GTPSA <code>Descriptor</code> to <code>AutoGTPSA</code>, it is the responsibility of the user to ensure that the number of <a href="https://bmad-sim.github.io/GTPSA.jl/stable/quickstart/#Calculating-a-Truncated-Power-Series">GTPSA &quot;variables&quot;</a> specified in the <code>Descriptor</code> is consistent with the number of inputs of the provided function. Undefined behavior and crashes may occur if this is not the case.</p></div></div><h3 id="PolyesterForwardDiff"><a class="docs-heading-anchor" href="#PolyesterForwardDiff">PolyesterForwardDiff</a><a id="PolyesterForwardDiff-1"></a><a class="docs-heading-anchor-permalink" href="#PolyesterForwardDiff" title="Permalink"></a></h3><p>Most operators fall back on <code>AutoForwardDiff</code>.</p><h3 id="ReverseDiff"><a class="docs-heading-anchor" href="#ReverseDiff">ReverseDiff</a><a id="ReverseDiff-1"></a><a class="docs-heading-anchor-permalink" href="#ReverseDiff" title="Permalink"></a></h3><p>With <code>AutoReverseDiff(compile=false)</code>, preparation preallocates a <a href="https://juliadiff.org/ReverseDiff.jl/dev/api/#The-AbstractConfig-API">config</a>.</p><p>With <code>AutoReverseDiff(compile=true)</code>, preparation records a <a href="https://juliadiff.org/ReverseDiff.jl/dev/api/#The-AbstractTape-API">tape</a> of the function&#39;s execution. This tape is computed from the input <code>x</code> provided at preparation time. It is control-flow dependent, so only one branch is recorded at each <code>if</code> statement.</p><div class="admonition is-danger"><header class="admonition-header">Danger</header><div class="admonition-body"><p>If your function has value-specific control flow (like <code>if x[1] &gt; 0</code> or <code>if c == 1</code>), you may get silently wrong results whenever it takes new branches that were not taken during preparation. You must make sure to run preparation with an input and contexts whose values trigger the correct control flow for future executions.</p></div></div><p>Whenever contexts are provided, tape recording is deactivated in all cases, because otherwise the context values would be hardcoded into a tape.</p><h3 id="Symbolics"><a class="docs-heading-anchor" href="#Symbolics">Symbolics</a><a id="Symbolics-1"></a><a class="docs-heading-anchor-permalink" href="#Symbolics" title="Permalink"></a></h3><p>For all operators, preparation generates an <a href="https://docs.sciml.ai/Symbolics/stable/manual/build_function/">executable function</a> from the symbolic expression of the differentiated function.</p><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Preparation can be very slow for symbolic AD.</p></div></div><h3 id="Mooncake"><a class="docs-heading-anchor" href="#Mooncake">Mooncake</a><a id="Mooncake-1"></a><a class="docs-heading-anchor-permalink" href="#Mooncake" title="Permalink"></a></h3><p>For <code>pullback</code>, preparation <a href="https://github.com/compintell/Mooncake.jl?tab=readme-ov-file#how-it-works">builds the reverse rule</a> of the function.</p><h3 id="Tracker"><a class="docs-heading-anchor" href="#Tracker">Tracker</a><a id="Tracker-1"></a><a class="docs-heading-anchor-permalink" href="#Tracker" title="Permalink"></a></h3><p>We implement <code>pullback</code> based on <code>Tracker.back</code>. Same-point preparation runs the forward sweep and returns the pullback closure at <code>x</code>.</p><h3 id="Zygote"><a class="docs-heading-anchor" href="#Zygote">Zygote</a><a id="Zygote-1"></a><a class="docs-heading-anchor-permalink" href="#Zygote" title="Permalink"></a></h3><p>We implement <code>pullback</code> based on <code>Zygote.pullback</code>. Same-point preparation runs the forward sweep and returns the pullback closure at <code>x</code>.</p><script type="module">import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
mermaid.initialize({
    startOnLoad: true,
    theme: "neutral"
});
</script></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../operators/">¬´ Operators</a><a class="docs-footer-nextpage" href="../advanced/">Advanced features ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Thursday 30 January 2025 20:59">Thursday 30 January 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
